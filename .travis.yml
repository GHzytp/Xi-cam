matrix:
  include:
  - os: linux
    language: python
    python: 3.7
    services:
    - xvfb
    before_install:
    - python --version
    - pip install --upgrade pip
    - export DISPLAY=:99.0
    after_success:
    - pip install .[docs]
    - "(cd docs && make html)"
    - bash <(curl -s https://codecov.io/bash)
  - os: windows
    language: shell
    before_install:
    - choco install python --version 3.7.5
    after_script:
    - pyinstaller --clean --onefile --noconsole --paths C:\Windows\System32\downlevel
      Xi-cam.spec
    env: PATH=/c/Python37:/c/Python37/Scripts:$PATH
env: TRAVIS=True
cache:
  apt: true
  pip: true
addons:
  apt:
    packages:
    - qtbase5-dev
before_install:
- python --version
install:
- pip install --upgrade attrs>=17.4.0
- pip install --upgrade setuptools wheel
- pip install .[pyqt5,tests,freeze]
script:
- 'pylint xicam --errors-only || :'
- 'pytest --cov=xicam --cov-config=.coveragerc . || :'
deploy:
  skip_cleanup: true
  provider: pypi
  user: __token__
  distributions: sdist bdist_wheel bdist_egg
  on:
    tags: true
    os: linux
  password:
    secure: Y3fOoehpUTrxjwgwjbzoHwstAB5C9noZyX6/2TqOV5WYP4uaWY5SsabuSPAaULICq3G107Imj2zWpzmfGzykYr8V84VXCsUL7I/9hvb1hW0VftzRBRdjcf3QSPi2d3bwhBpYexOtlPIJaXEYNZqD5aPNpfDFvzazvvBs/Ls81AMSShAAW5shjtKDu6w5MvI0D/KoKEbTrWmUMpBqBbdBzuLWkCzA7abBfMwVUED2PpXBatjRNh9ncmfcZdapQeMmitKgvJujOGrrXiCeGILpTt8x7sz4mKA1gpxXbZILN+F3cqUAjP1HvP9hwcnHqcJx2ucIAfF76JuKgFa6EqwEmZeY9emqc5hL2M+7I0Y4Bf3GDHQPpjnPyDgOsbokZgb9D+4fbK1U3SBfgDALGeqc3Og/2OqYi495iONx7lGMe5qUS+sZUdWwjY+pioGNXmVOgIQq3f9s4XL1qZSOor/VBAIzsg9NI7XDyO2AiOWxgp1NK17AJ+nr4DjcdCXuWg6/afGY+qI+mUesfVWy7TDXfiQw4he17yJ6XTl++vjbxRvR9shth/8CfOPeGU5nlkBv0avrI2EgHlUOCJ8DAoanctj1h3exDqMk7yBDRbHDyIU/a9hlogMBvq1yAeIHdPk84QcU0mrUEuRQ0ICkvQGH8WF+IZ56XDKF7wZKZs4JRsA=
