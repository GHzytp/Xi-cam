matrix:
  include:
  - os: linux
    language: python
    python: 3.7
    services:
    - xvfb
    before_install:
    - python --version
    - pip install --upgrade pip
    - export DISPLAY=:99.0
    after_success:
    - pip install .[docs]
    - "(cd docs && make html)"
    - bash <(curl -s https://codecov.io/bash)
  - os: windows
    language: shell
    before_install:
    - choco install python --version 3.7.5
    after_script:
    - pyinstaller --clean --onefile --noconsole --paths C:\Windows\System32\downlevel Xi-cam.spec
    env: PATH=/c/Python37:/c/Python37/Scripts:$PATH

env: TRAVIS=True

cache:
  apt: true
  pip: true

addons:
  apt:
    packages:
    - qtbase5-dev

before_install:
- python --version

install:
- pip install --upgrade attrs>=17.4.0
- pip install --upgrade setuptools wheel
- pip install .[pyqt5,tests,freeze]

script:
- 'pylint xicam --errors-only || :'
- 'pytest --cov=xicam --cov-config=.coveragerc . || :'

deploy:
  skip_cleanup: true
  provider: pypi
  user: ronpandolfi
  password:
    secure: JeybIx5iI0rnEu0XU2BzVQ4JZjIZWyLhOAzNsdYDPQlSdpp1CiD/Xk2s0uCz6Y4jSd3GfPIPyZY6rC3kQdNZlAoOL3Mz7yu4WLKEdJrPizSmoYKkYsoUiPsruxZUoKWBsfvfnGvaJp4wf5VtTT+K7KjYehshu/fKCARmWLtUhYkDsCI3Yc7+mK2u0tSSBlXcOmZr+vj4WwqdEyIn2aTu1vKn45NgFU2BNvI5EZIeJ2KlCW60cwAma4VOtIqsYmBBThmINBKU+A0ZnffS6KmfRo3SE7fT4CAVGYxjzbifY46+ouj1/k0RzqPV4iXMGdZYwHFmpN8RWeI6KSNPvh9NTnY4GY3kOfqJv3xrc3TTxqyXcgrngDOYFMyAiq1eBHUIw0BoB8aIsgvLD1zvY/Oq4/HMOzQfOrxr/lz6U8lwy6ukLgInfhfPcyRnT8RsKOkQ5RjCMfY1cv2kmnOXC/sdq3NiKo8aI9IciFfxB/Am2KelV3PSZMHsD7Cq7enkrr5iJZ1P/tiVZl6wXRCJEgoJPQ/ePOVejvLwlxAa+j6gqP1MLPZdgmerooAkyIJHsiNNrr95jnxzkE+erAsF4g9uH2ZAHgRYxrA+7P5A4i9VkriyxXRPmOkM14BpAJOcAnbc7BL287/JR+FIsLj/T/KiCO8+FHEBpiMCYjCsPcAT4kI=
  distributions: sdist bdist_wheel bdist_egg
  on:
    tags: true
    os: linux
